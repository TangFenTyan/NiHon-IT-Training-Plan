## 实现细节
* 在列出【发布中】商品的页面，需求是想要做到按发布时间从近到远从上到下排序，这样能第一眼先看到最近发布的商品。一开始的思路是得到`res.data`后用`sort`对其倒序，但终归差点意思；后来才想到以前课程里曾额外添加json查询条件来实现直接获得目标数据的方式，因此`http://localhost:5000/goods?sellerId=3&_sort=publishTime&_order=desc&state_ne=0&state_ne=4`得以实现
* 商品详情页中，如果是自己发布的商品，则仅显示修改按钮；他人发布的商品则显示购买或收藏按钮，且可对发布者进行关注操作
* 优化注册功能，现在可以提供默认地址与上传头像（均为非必填项）。前者会在发布商品时默认填充地址栏，后者则会替代原本的默认头像，并计划在后续的个人主页功能中提供修改头像功能
* 商品收藏功能，在`users`下建立了`starList`数组，用户信息会记录点过收藏的商品`id`，之后会在个人主页下的收藏夹中查看历史收藏商品；商品详情也会记录被哪些用户id收藏过，并统计总数展示；自己发布的商品相关的`收藏`等按钮设为`disabled`状态
* 用户关注功能，在`users`下建立了`followList`数组，记录关注中的其他用户；自己头像后方的`关注`按钮设为`disabled`状态
* 头像组件如果没有相关联的上传图片做头像，则会启用默认头像格式，具体形式为底色+用户名前缀；有图片则显示头像图片
* 商品图片`card`展示时，由于原图片尺寸不一，导致`card`高度也发生了浮动。采用`<img style={{maxHeight:"150px",objectFit:"cover"}}/>`实现自动居中裁切，且更进一步，未来可以考虑引入[antd-img-crop](https://www.npmjs.com/package/antd-img-crop)使得图片在`upload`时就进行裁切并存储后端
* 新增tags数据集，可在发布商品时填写tag（重复tag会利用`Set`唯一化，不会重复提交），且同名tag会进行计数，体现热度，也会在搜索页通过tag进行展示和查找；在商品详情中展示的tag对其进行点击也能直接跳转到对应tag的分类过滤商品列表中
* 用户数据注册时新增注册时间，方便在个人主页展示计算创号天数
* 商品收藏功能和用户关注功能在后续个人主页数据展示时发现，虽然只对动作发起者或接受者的一方的名下记录数据即可，但实际运用中查询代码会变得复杂且查询速度缓慢（需遍历users或goods一遍，当数据量变大时每次刷新网页都要这样遍历就只为了省一点存储空间显然不是合适的方式，所以后面改成了对双方的名下数据都进行记录list）而更复杂的调用和匹配方法其实已经在tags中进行了练习，关联到tagList、判断数组中是否存在某个tagId等，所以此处就不再这样写复杂了
* 搜索页中用户名过长时会隐藏到后续的浏览量标签下层，来防止溢出挤占空间，但还有很多类似的地方都需要这种防字符串过长溢出的功能，就没有去一一测试完善了
* 商品快照就是在下单时记录订单信息的同时把当时最新修改版本的商品基本信息也一并记录进去
* 买方催发快递后，卖方发货填写单号的地方会出现讨嫌的小红点
* 细化了用户权限，state为0时账户功能正常；1时禁购，商品详情页无法购买，且无法进入顶部栏商品搜索页查看其他商品，登录后由原先的默认跳转商品搜索页变成跳转到主页；2时禁售，顶部栏无法使用商品发布功能，登录后同样会有消息提醒；3时封禁，视为同时禁购和禁售，但保留历史订单查看等侧边栏功能，且禁止主页充值或修改信息；4时已注销，无法登陆
* 给管理员创建时新增auditNum和argueNum属性，分别记录其完成的发布审查件数和申诉仲裁件数；同时，在审核或仲裁后记录当时操作的管理员名称，用户可以在【发布中】查看
* 还是把标签管理加回来了，否则这个系统如果不直接去查看json server的话就很难对标签的整体情况有查看方法。也就顺便增加一个state，0为正常，1为屏蔽，来屏蔽部分不合适的标签，这些标签不会被渲染到商品详情界面，但依然会在后台继续记录相应的数据，直到某个时候被解除屏蔽
* 基于umi dva实现右上角余额数值的全局状态管理，登录或重新进入网页时会对counter进行更新，也有基本的加减功能dispatch负责余额处理
* 原本打算使用redux数据持久化去做关于商品或订单等id动态路由的权限控制，防止用户直接访问非自己创建的商品修改或订单详情页面，这样是把判定放到了Auth.jsx里面去；但在研究redux在umi中的写法时，想到之前的商品详情页面，如果是自己创建的商品，那么打开后不是购买按钮，相似的思路可以放到每个具体页面中去，获取token信息后如果这个路径下的内容并非自己权限内，则跳转404，这样就不用在Auth.jsx里去判定了，也就不需要管理一堆id数组；不知道实际运用的话是哪种方式，我个人觉得管理起一大堆id权限数组比较繁琐，就还是去具体页面具体判断着做了。具体的权限控制为：1. goods/modify/:id仅在tokenId和该商品创建者id相同时展示；2. goods/order/:id仅在tokenId和该商品创建者id不同时展示（自己不能购买自己创建的商品；禁购用户goods/order全都不能打开所以不用再单独去设置了）；3. snapshots/:id和orders/:id仅在管理员级别账户或者sellerId或buyerId对得上tokenId时进行展示订单详情；此外，该id所关联的内容不存在于数据库中时也跳转404；对特定标签的搜索也遵循权限控制，state为1意味着被超级管理员认为是不适合展示的标签，此时虽然所有页面上都不会再对该标签进行展示，手动输入url也依然会进行权限控制判断
* 实现了评价星数和订单详情中的星数展示，但原本是还想把每个卖家总体获得的平均星数也在卖家主页进行展示的，但antd没有提供小数点对应的半满星星图标，如果只是在主页写个"4.2"这样的平均数，那就和之前计算收藏量之类的一样的，也不够美观，就不做这个了暂时

## 细节思考
* 组件随浏览器大小缩放的动态变化（实际中是否都需要用百分数形式的距离而不用绝对px距离来写）
* json server里embed和expand都需要对应的名称+Id形式来写数据库后才能找到对应关系，但如果举例某个goods里既有sellerId又有buyerId信息（虽然我这里只有sellerId，所以直接改成userId就行），那要关联到user的话。。
* `http://localhost:5000/goods/16?_expand=user`怎么才能不对`password`之类的属性进行查询，否则即使setData时不将该字段写进去，后端也会把含有`password`这种信息的内容发送过来；如果是MySQL之类的语句查询的话我有搜到相关的处理方式，用URL方式查询时的处理方式暂时没找到
    ```
    {
    "userId": 3,
    "state": 1,
    "publishTime": 1708516893580,
    "introduction": "123",
    "yuanjia": 0,
    "shoujia": "123",
    "dizhi": [
        "天津市",
        "市辖区",
        "和平区"
    ],
    "tupian": "036033a8cfd69253.jpg",
    "id": 16,
    "user": {
        "username": "toubun",
        "state": 0,
        "password": "123",
        "id": 3,
        "balance": 100
    }
    }
    ```
* 数组渲染之前一定要判空；图片渲染则给占位图
* 子对象渲染问题
* 上传头像部分（包括上传商品图片），如果上传错误格式的图片或再次上传其他图片，都会增加`filelist`，需优化
* 用户名、浏览量等信息展示时，如果长度超长，需要进行裁剪后展示
* 管理员身份账号应该是怎样的实现形式，和普通账号如何区分开
* 只应从token里取id，因为其他信息诸如用户名密码，是有可能发生修改的，而token则是在登录的那一瞬间被写入不变了；同时也不应将其作为state来操作，如对其使用useState进行修改，都会引发意料之外的结果
* 内容子组件的state修改后，layout中并未得到及时修改，导致如修改用户名后，内容子组件的相应字段能及时得到更新而右上角的信息则需要刷新网页后才能得到更新，所以之后可能需要考虑组件间的传值什么的

## 尚待实现
* 左上方返回按钮√
* 修改页面取消按钮返回上一级
* 修改页面上传图片默认值
* modify-id 默认填充值
* 原价为0不显示
* tag在输入框中回车转化为tag标签形式展示
* 商品搜索页设置过滤条件
* 图片组件已上传值的显示，以后要做这块的话单独做个MyComponent比较好，现在整复杂了要改还不好改
* 审核修改发布时可以尝试只展示发生变化的表单项，方便区分
* 使用协议用modal实现而不去跳转新页面
* 切换页面时MyHeader的页签值没有跟着变化，页签还显示在发布区但其实内容已经跳转到主页了，需要组件间数据通信
* http://localhost:8000/argue-manage/unfinish商品快照栏标题内容在半屏显示时变成竖排
* 卖方和管理员都可以写申诉评论
* 订单修改时间
* 还可以增加【举报】按钮在其他用户的个人主页上，用户进行举报后，管理员那边会有专门的标记筛选(`users.warning`)之类的，然后能更精准的找到需要进行权限管理的用户。但类似的操作已经有不少了就不细化了
* 原本想做tag之间关联性的内容，放在超级管理的权限下（比如把“电脑”、“装机”等tag关联到一起）；又或者设置板块（电子板块、生活用品板块等）；前者实际上应该用一些相关性算法来自动实现比较好；后者倒还可以，但也没太多新东西做了，所以随便给超级管理一个管理管理员帐号的权限好了，尽快收尾开始学后端
* 进入商品详情页时增加浏览量的方法其实还可以用给增加对应标签的浏览量，这样就能汇总出所有标签中的热度排序，但没什么新东西就先不做了，留作以后备用
* 浏览记录功能，商品页面被访问时为该商品的访问量+1,；同时新增users下的history数据项，可记录最近浏览的20个商品id方便之后查找，且该数组中商品id具有唯一性，重复访问同一商品只会使得该商品id上浮到数组顶部